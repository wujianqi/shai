/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function t(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<r;e++)for(var s=arguments[e],a=0,o=s.length;a<o;a++,n++)i[n]=s[a];return i}var e,r,i=function(t){void 0===t&&(t="-");var e=(new Date).getTime();return["xxxxxxxx","xxxx","4xxx","yxxx","xxxxxxxxxxxx"].join(t).replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}))};function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function s(t,e){if(Object.assign)return Object.assign(t,e);for(var r in e)n(e,r)&&(t[r]=e[r]);return t}!function(t){t[t.increment=0]="increment",t[t.uuid=1]="uuid"}(e||(e={})),function(t){t[t.some=0]="some",t[t.every=1]="every",t[t.unique=2]="unique"}(r||(r={}));var a=["操作失败！","查询参数错误！","没有请求参数","操作成功！"],o=function(){function o(){this.__datas=[],this.__opt={uniqueKey:"id",uniqueType:e.increment,page:{sizeField:"pageSize",currentField:"pageIndex",countField:"pageCount",totalField:"total",resultsField:"list"},api:{statusField:"code",messageField:"message",resultsField:"data",successCode:0,failureCode:500}},this.exist=this.exist.bind(this),this.create=this.create.bind(this),this.update=this.update.bind(this),this.read=this.read.bind(this),this.delete=this.delete.bind(this),this.list=this.list.bind(this),this.pageList=this.pageList.bind(this),this.async=this.async.bind(this)}return o.prototype.success=function(t,e){var r;return(r={})[this.__opt.api.statusField]=[this.__opt.api.successCode],r[this.__opt.api.messageField]="string"!=typeof e?a[3]:e,r[this.__opt.api.resultsField]=t,r},o.prototype.failure=function(t,e){var r;return(r={})[this.__opt.api.statusField]=[this.__opt.api.failureCode],r[this.__opt.api.messageField]="string"!=typeof e?a[0]:e,r},o.prototype.__filter=function(t,i,n){var s=this;if(n===r.unique&&t&&!t[this.__opt.uniqueKey])return this.failure(1,a[1]);var o=t[this.__opt.uniqueKey],u=[];if(o){var _=this.__opt.uniqueType===e.increment;"string"==typeof o&&_&&/\d+/.test(o)&&(t[this.__opt.uniqueKey]=parseInt(o))}return n===r.unique&&o?u=this.__datas.filter((function(e){return e[s.__opt.uniqueKey]===t[s.__opt.uniqueKey]})):n!==r.some&&n!==r.every||(u=this.__datas.filter((function(e){return Object.keys(t)[n===r.some?"some":"every"]((function(r){return e[r]===t[r]}))}))),i(u)},o.prototype.__noparam=function(){return this.failure(2,a[2])},Object.defineProperty(o.prototype,"data",{get:function(){return this.__datas},set:function(t){t&&t.length&&(this.__datas=t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"config",{set:function(t){this.__opt=s(this.__opt,t)},enumerable:!0,configurable:!0}),o.prototype.create=function(t,r,n){if(!t)return this.__noparam();var s=Array.isArray(t),a=this.__datas.length?this.__datas[0]:s?t[0]:t,o=this.__opt.uniqueType===e.increment,u=Object.keys(a),_=this.__datas.length?this.__datas[this.__datas.length-1][this.__opt.uniqueKey]:0;if(s)for(var h=0;h<t.length;h++){var p=t[h];if(!Object.keys(p).every((function(t){return~u.indexOf(t)})))return this.failure(0,n);o&&_++,p[this.__opt.uniqueKey]=o?_:i()}else{if(a!==t&&!Object.keys(t).every((function(t){return~u.indexOf(t)})))return this.failure(0,n);o&&_++,t[this.__opt.uniqueKey]=o?_:i()}return this.__datas=this.__datas.concat(t),this.success(t,r)},o.prototype.update=function(t,e,i){var s=this;return t?this.__filter(t,(function(r){if(r.length){for(var a in t)n(t,a)&&r[0][a]&&(r[0][a]=t[a]);return s.success(r[0],e)}return s.failure(0,i)}),r.unique):this.__noparam()},o.prototype.read=function(t,e,i,n){var a=this;return t?this.__filter(t,(function(t){if(1===t.length){var r={};return"object"==typeof n&&(r=s(r,t[0]),r=s(r,n)),a.success("object"==typeof n?r:t[0],e)}return a.failure(0,i)}),r.every):this.__noparam()},o.prototype.delete=function(t,r,i){var n=this;if(!t)return this.__noparam();Array.isArray(t)||(t=[t]);var s=0;return t.forEach((function(t){for(var r=0;r<n.__datas.length;r++){var i=n.__datas[r],a="object"==typeof t?t[n.__opt.uniqueKey]:t;if((n.__opt.uniqueType===e.increment&&/\d+/.test(a)?parseInt(a):a)===i[n.__opt.uniqueKey]){n.__datas.splice(r,1),s++;break}}})),s>0?this.success(0,r):this.failure(0,i)},o.prototype.exist=function(t,e,i,n){var a=this;return t?this.__filter(t,(function(t){if(1===t.length){var r={};return"object"==typeof n&&(r=s(r,t[0]),r=s(r,n)),a.success("object"==typeof n?r:t[0],e)}return a.failure(0,i)}),r.every):this.__noparam()},o.prototype.list=function(t,e){var i=this;return t&&Object.keys(t).length?this.__filter(t,(function(t){return t.length?i.success(t,e):i.success(i.__datas,e)}),r.some):this.success(this.__datas,e)},o.prototype.pageList=function(t,e){var i,n=this,s=t[this.__opt.page.sizeField],a=t[this.__opt.page.currentField];if(!s||!a)return this.__noparam();delete t[this.__opt.page.sizeField],delete t[this.__opt.page.currentField],"string"==typeof s&&(s=parseInt(s)),"string"==typeof a&&(a=parseInt(a));var o=this.__datas;t&&this.__filter(t,(function(t){return t.length?o=t:n.__datas.length?o=n.__datas:t}),r.some);var u=o.length,_=Math.ceil(u/s),h=a>_?_:a<1?1:a,p=u-(_-1)*s+(_-1)*s,c=this.__datas.slice((a-1)*s,a<_?a*s:p);return this.success(((i={})[this.__opt.page.totalField]=u,i[this.__opt.page.currentField]=h,i[this.__opt.page.sizeField]=s,i[this.__opt.page.countField]=_,i[this.__opt.page.resultsField]=c,i),e)},o.prototype.async=function(e,r){for(var i=this,s=[],a=2;a<arguments.length;a++)s[a-2]=arguments[a];if(!Promise)throw new Error("运行环境不支持异步！");if(!n(this,e))throw new Error("没有找到对应方法！");var o=s[s.length-1],u="number"==typeof o?o:500;return new Promise((function(n){setTimeout((function(){n([200,i[e].apply(i,t([r],s))])}),u)}))},o}(),u=Symbol?Symbol():"▒";function _(t){var e=Array.isArray(t)?[]:{};for(var r in t)if(n(t,r)){var i=t[r];e[r]="object"==typeof i?_(i):i}return e}var h=function(){function t(){this.__funcs=[],this.__data=[],this.__propKey="setting",this.__access=new o,this.use=this.use.bind(this),this.gen=this.gen.bind(this)}return t.prototype.setv=function(t,e){var r=t.length-1;t.reduce((function(t,i,n){return n===r&&(t[i]=e),t[i]}),this.__data)},t.prototype.addChild=function(t,e,r){var i=r.key||"children",n=this.getList(t,r);if(e<1)return n;var s=_(n);e--;for(var a=0,o=s.length;a<o;a++)s[a][i]=1===e?_(n):this.addChild(n[a],e,r);return s},t.prototype.getList=function(t,e){if(e){var r=function(t){var e=1;return"number"==typeof t?e=t:Array.isArray(t)&&"number"==typeof t[0]&&"number"==typeof t[1]&&(e=~~(Math.random()*(t[1]-t[0])+t[0])),e},i="number"==typeof e||Array.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]?r(e):"object"==typeof e&&e.length?r(e.length):1,n=new Array(i);delete t[this.__propKey];for(var s=0;s<i;s++)n[s]=_(t);t=n}return t},t.prototype.parseBlock=function(){var t=this,e=function(r,i){!Array.isArray(r)&&n(r,t.__propKey)&&(r=function(e){var r=e[t.__propKey];if(Array.isArray(r)||"object"!=typeof r)e=t.getList(e,r);else{var i="number"==typeof r.level?r.level:1;e=t.addChild(e,i,r)}return e}(r),i?t.setv(i,r):t.setv([],t.__data=r));var s=function(t){if(n(r,t)){var s=r[t];Array.isArray(s)&&s[0]!==u?s.forEach((function(r,n){return e(r,i?i.concat([t,n]):[t,n])})):Array.isArray(s)||"object"!=typeof s||e(s,i?i.concat([t]):[t])}};for(var a in r)s(a)};e(this.__data)},t.prototype.setValues=function(t,e){var r=this;if(Array.isArray(t))if(t[0]===u){var i=e||[],n=this.__funcs[t[1]].concat();try{this.setv(i,n.length>0?n[0].apply(n,n[1]):t)}catch(e){throw new Error((i.length>0?i.join("."):t)+": error, "+e)}}else t.forEach((function(t,i){return r.setValues(t,e?e.concat([i]):[i])}));else"object"==typeof t&&Object.keys(t).forEach((function(i){return r.setValues(t[i],e?e.concat([i]):[i])}))},t.prototype.use=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return[u,this.__funcs.push([t,e])-1]},t.prototype.gen=function(t,e){if("object"==typeof t)return e&&(this.__propKey=e),this.__data=t,this.parseBlock(),this.setValues(this.__data),this.__access.data=this.__data,this.__data},Object.defineProperty(t.prototype,"access",{get:function(){return this.__access},enumerable:!0,configurable:!0}),t}();export default h;
//# sourceMappingURL=shai.js.map
