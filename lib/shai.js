!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Shai=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function t(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}var e,r,i=function(t){void 0===t&&(t="-");var e=(new Date).getTime();return["xxxxxxxx","xxxx","4xxx","yxxx","xxxxxxxxxxxx"].join(t).replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}))};function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function s(t,e){if(Object.assign)return Object.assign(t,e);for(var r in e)n(e,r)&&(t[r]=e[r]);return t}!function(t){t[t.increment=0]="increment",t[t.uuid=1]="uuid"}(e||(e={})),function(t){t[t.some=0]="some",t[t.every=1]="every",t[t.unique=2]="unique"}(r||(r={}));var o=["操作失败！","查询参数错误！","没有请求参数","操作成功！"],a=function(){function a(){this.__datas=[],this.__opt={uniqueKey:"id",uniqueType:e.increment,page:{sizeField:"pageSize",currentField:"pageIndex",countField:"pageCount",totalField:"total",resultsField:"list"},api:{statusField:"code",messageField:"message",resultsField:"data",successCode:0,failureCode:500}},this.exist=this.exist.bind(this),this.create=this.create.bind(this),this.update=this.update.bind(this),this.read=this.read.bind(this),this.delete=this.delete.bind(this),this.list=this.list.bind(this),this.pageList=this.pageList.bind(this),this.async=this.async.bind(this)}return a.prototype.success=function(t,e){var r;return(r={})[this.__opt.api.statusField]=[this.__opt.api.successCode],r[this.__opt.api.messageField]="string"!=typeof e?o[3]:e,r[this.__opt.api.resultsField]=t,r},a.prototype.failure=function(t,e){var r;return(r={})[this.__opt.api.statusField]=[this.__opt.api.failureCode],r[this.__opt.api.messageField]="string"!=typeof e?o[0]:e,r},a.prototype.__filter=function(t,i,n){var s=this;if(n===r.unique&&t&&!t[this.__opt.uniqueKey])return this.failure(1,o[1]);var a=t[this.__opt.uniqueKey],u=[];if(a){var p=this.__opt.uniqueType===e.increment;"string"==typeof a&&p&&/\d+/.test(a)&&(t[this.__opt.uniqueKey]=parseInt(a))}return n===r.unique&&a?u=this.__datas.filter((function(e){return e[s.__opt.uniqueKey]===t[s.__opt.uniqueKey]})):n!==r.some&&n!==r.every||(u=this.__datas.filter((function(e){return Object.keys(t)[n===r.some?"some":"every"]((function(r){return e[r]===t[r]}))}))),i(u)},a.prototype.__noparam=function(){return this.failure(2,o[2])},Object.defineProperty(a.prototype,"data",{get:function(){return this.__datas},set:function(t){t&&t.length&&(this.__datas=t)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"config",{set:function(t){this.__opt=s(this.__opt,t)},enumerable:!0,configurable:!0}),a.prototype.create=function(t,r,n){if(!t)return this.__noparam();var s=Array.isArray(t),o=this.__datas.length?this.__datas[0]:s?t[0]:t,a=this.__opt.uniqueType===e.increment,u=Object.keys(o),p=this.__datas.length?this.__datas[this.__datas.length-1][this.__opt.uniqueKey]:0;if(s)for(var h=0;h<t.length;h++){var _=t[h];if(!Object.keys(_).every((function(t){return~u.indexOf(t)})))return this.failure(0,n);a&&p++,_[this.__opt.uniqueKey]=a?p:i()}else{if(o!==t&&!Object.keys(t).every((function(t){return~u.indexOf(t)})))return this.failure(0,n);a&&p++,t[this.__opt.uniqueKey]=a?p:i()}return this.__datas=this.__datas.concat(t),this.success(t,r)},a.prototype.update=function(t,e,i){var s=this;return t?this.__filter(t,(function(r){if(r.length){for(var o in t)n(t,o)&&r[0][o]&&(r[0][o]=t[o]);return s.success(r[0],e)}return s.failure(0,i)}),r.unique):this.__noparam()},a.prototype.read=function(t,e,i,n){var o=this;return t?this.__filter(t,(function(t){if(1===t.length){var r={};return"object"==typeof n&&(r=s(r,t[0]),r=s(r,n)),o.success("object"==typeof n?r:t[0],e)}return o.failure(0,i)}),r.every):this.__noparam()},a.prototype.delete=function(t,r,i){var n=this;if(!t)return this.__noparam();Array.isArray(t)||(t=[t]);var s=0;return t.forEach((function(t){for(var r=0;r<n.__datas.length;r++){var i=n.__datas[r],o="object"==typeof t?t[n.__opt.uniqueKey]:t;if((n.__opt.uniqueType===e.increment&&/\d+/.test(o)?parseInt(o):o)===i[n.__opt.uniqueKey]){n.__datas.splice(r,1),s++;break}}})),s>0?this.success(0,r):this.failure(0,i)},a.prototype.exist=function(t,e,i,n){var o=this;return t?this.__filter(t,(function(t){if(1===t.length){var r={};return"object"==typeof n&&(r=s(r,t[0]),r=s(r,n)),o.success("object"==typeof n?r:t[0],e)}return o.failure(0,i)}),r.every):this.__noparam()},a.prototype.list=function(t,e){var i=this;return t&&Object.keys(t).length?this.__filter(t,(function(t){return t.length?i.success(t,e):i.success(i.__datas,e)}),r.some):this.success(this.__datas,e)},a.prototype.pageList=function(t,e){var i,n=this,s=t[this.__opt.page.sizeField],o=t[this.__opt.page.currentField];if(!s||!o)return this.__noparam();delete t[this.__opt.page.sizeField],delete t[this.__opt.page.currentField],"string"==typeof s&&(s=parseInt(s)),"string"==typeof o&&(o=parseInt(o));var a=this.__datas;t&&this.__filter(t,(function(t){return t.length?a=t:n.__datas.length?a=n.__datas:t}),r.some);var u=a.length,p=Math.ceil(u/s),h=o>p?p:o<1?1:o,_=u-(p-1)*s+(p-1)*s,c=this.__datas.slice((o-1)*s,o<p?o*s:_);return this.success(((i={})[this.__opt.page.totalField]=u,i[this.__opt.page.currentField]=h,i[this.__opt.page.sizeField]=s,i[this.__opt.page.countField]=p,i[this.__opt.page.resultsField]=c,i),e)},a.prototype.async=function(e,r){for(var i=this,s=[],o=2;o<arguments.length;o++)s[o-2]=arguments[o];if(!Promise)throw new Error("运行环境不支持异步！");if(!n(this,e))throw new Error("没有找到对应方法！");var a=s[s.length-1],u="number"==typeof a?a:500;return new Promise((function(n){setTimeout((function(){n([200,i[e].apply(i,t([r],s))])}),u)}))},a}(),u=Symbol?Symbol():"▒";function p(t){var e=Array.isArray(t)?[]:{};for(var r in t)if(n(t,r)){var i=t[r];e[r]="object"==typeof i?p(i):i}return e}return function(){function t(){this.__funcs=[],this.__data=[],this.__propKey="setting",this.__access=new a,this.use=this.use.bind(this),this.gen=this.gen.bind(this)}return t.prototype.setv=function(t,e){var r=t.length-1;t.reduce((function(t,i,n){return n===r&&(t[i]=e),t[i]}),this.__data)},t.prototype.addChild=function(t,e,r){var i=r.key||"children",n=this.getList(t,r);if(e<1)return n;var s=p(n);e--;for(var o=0,a=s.length;o<a;o++)s[o][i]=1===e?p(n):this.addChild(n[o],e,r);return s},t.prototype.getList=function(t,e){if(e){var r=function(t){var e=1;return"number"==typeof t?e=t:Array.isArray(t)&&"number"==typeof t[0]&&"number"==typeof t[1]&&(e=~~(Math.random()*(t[1]-t[0])+t[0])),e},i="number"==typeof e||Array.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]?r(e):"object"==typeof e&&e.length?r(e.length):1,n=new Array(i);delete t[this.__propKey];for(var s=0;s<i;s++)n[s]=p(t);t=n}return t},t.prototype.parseBlock=function(){var t=this,e=function(r,i){!Array.isArray(r)&&n(r,t.__propKey)&&(r=function(e){var r=e[t.__propKey];if(Array.isArray(r)||"object"!=typeof r)e=t.getList(e,r);else{var i="number"==typeof r.level?r.level:1;e=t.addChild(e,i,r)}return e}(r),i?t.setv(i,r):t.setv([],t.__data=r));var s=function(t){if(n(r,t)){var s=r[t];Array.isArray(s)&&s[0]!==u?s.forEach((function(r,n){return e(r,i?i.concat([t,n]):[t,n])})):Array.isArray(s)||"object"!=typeof s||e(s,i?i.concat([t]):[t])}};for(var o in r)s(o)};e(this.__data)},t.prototype.setValues=function(t,e){var r=this;if(Array.isArray(t))if(t[0]===u){var i=e||[],n=this.__funcs[t[1]].concat();try{this.setv(i,n.length>0?n[0].apply(n,n[1]):t)}catch(e){throw new Error((i.length>0?i.join("."):t)+": error, "+e)}}else t.forEach((function(t,i){return r.setValues(t,e?e.concat([i]):[i])}));else"object"==typeof t&&Object.keys(t).forEach((function(i){return r.setValues(t[i],e?e.concat([i]):[i])}))},t.prototype.use=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return[u,this.__funcs.push([t,e])-1]},t.prototype.gen=function(t,e){if("object"==typeof t)return e&&(this.__propKey=e),this.__data=t,this.parseBlock(),this.setValues(this.__data),this.__access.data=this.__data,this.__data},Object.defineProperty(t.prototype,"access",{get:function(){return this.__access},enumerable:!0,configurable:!0}),t}()}));
//# sourceMappingURL=shai.js.map
