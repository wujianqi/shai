!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Shai=e()}(this,(function(){"use strict";var t,e,n=function(t){void 0===t&&(t="-");var e=(new Date).getTime();return["xxxxxxxx","xxxx","4xxx","yxxx","xxxxxxxxxxxx"].join(t).replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function i(t,e){if(Object.assign)return Object.assign(t,e);for(var n in e)r(e,n)&&(t[n]=e[n]);return t}!function(t){t[t.increment=0]="increment",t[t.uuid=1]="uuid"}(t||(t={})),function(t){t[t.some=0]="some",t[t.every=1]="every",t[t.unique=2]="unique"}(e||(e={}));var s=["操作失败！","查询参数错误！","没有请求参数","操作成功！"],a=function(){function a(){this.__datas=[],this.__opt={uniqueKey:"id",uniqueType:t.increment,asyncResult:function(t){return[200,t]},success:function(t,e){return{code:0,message:"string"!=typeof e?s[3]:e,data:t}},failure:function(t,e){return{code:500,message:"string"!=typeof e?s[0]:e}}},this.exist=this.exist.bind(this),this.create=this.create.bind(this),this.update=this.update.bind(this),this.read=this.read.bind(this),this.delete=this.delete.bind(this),this.list=this.list.bind(this),this.pageList=this.pageList.bind(this),this.asyncExist=this.asyncExist.bind(this),this.asyncCreate=this.asyncCreate.bind(this),this.asyncUpdate=this.asyncUpdate.bind(this),this.asyncRead=this.asyncRead.bind(this),this.asyncDelete=this.asyncDelete.bind(this),this.asyncList=this.asyncList.bind(this),this.asyncPageList=this.asyncPageList.bind(this)}return a.prototype.__filter=function(n,r,i){var a=this;if(i===e.unique&&n&&!n[this.__opt.uniqueKey])return this.__opt.failure(1,s[1]);var o=n[this.__opt.uniqueKey],u=[];if(o){var c=this.__opt.uniqueType===t.increment;"string"==typeof o&&c&&/\d+/.test(o)&&(n[this.__opt.uniqueKey]=parseInt(o))}return i===e.unique&&o?u=this.__datas.filter((function(t){return t[a.__opt.uniqueKey]===n[a.__opt.uniqueKey]})):i!==e.some&&i!==e.every||(u=this.__datas.filter((function(t){return Object.keys(n)[i===e.some?"some":"every"]((function(e){return t[e]===n[e]}))}))),r(u)},a.prototype.__async=function(t,e){var n=this;if(void 0===e&&(e=200),!Promise)throw new Error("运行环境不支持异步！");return new Promise((function(r){setTimeout((function(){r(n.__opt.asyncResult(t()))}),e)}))},a.prototype.__noparam=function(){return this.__opt.failure(2,s[2])},Object.defineProperty(a.prototype,"data",{get:function(){return this.__datas},set:function(t){t&&t.length&&(this.__datas=t)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"config",{set:function(t){this.__opt=i(this.__opt,t)},enumerable:!0,configurable:!0}),a.prototype.create=function(e,r,i){if(!e)return this.__noparam();var s=Array.isArray(e),a=this.__datas.length?this.__datas[0]:s?e[0]:e,o=this.__opt.uniqueType===t.increment,u=Object.keys(a),c=this.__datas.length?this.__datas[this.__datas.length-1][this.__opt.uniqueKey]:0;if(s)for(var _=0;_<e.length;_++){var h=e[_];if(!Object.keys(h).every((function(t){return~u.indexOf(t)})))return this.__opt.failure(0,i);o&&c++,h[this.__opt.uniqueKey]=o?c:n()}else{if(a!==e&&!Object.keys(e).every((function(t){return~u.indexOf(t)})))return this.__opt.failure(0,i);o&&c++,e[this.__opt.uniqueKey]=o?c:n()}return this.__datas=this.__datas.concat(e),this.__opt.success(e,r)},a.prototype.asyncCreate=function(t,e,n,r){var i=this;return this.__async((function(){return i.create(t,e,n)}),r)},a.prototype.update=function(t,n,i){var s=this;return t?this.__filter(t,(function(e){if(e.length){for(var a in t)r(t,a)&&e[0][a]&&(e[0][a]=t[a]);return s.__opt.success(e[0],n)}return s.__opt.failure(0,i)}),e.unique):this.__noparam()},a.prototype.asyncUpdate=function(t,e,n,r){var i=this;return this.__async((function(){return i.update(t,e,n)}),r)},a.prototype.read=function(t,n,r,s){var a=this;return t?this.__filter(t,(function(t){if(1===t.length){var e={};return"object"==typeof s&&(e=i(e,t[0]),e=i(e,s)),a.__opt.success("object"==typeof s?e:t[0],n)}return a.__opt.failure(0,r)}),e.every):this.__noparam()},a.prototype.asyncRead=function(t,e,n,r,i){var s=this;return this.__async((function(){return s.read(t,e,n,r)}),i)},a.prototype.delete=function(e,n,r){var i=this;if(!e)return this.__noparam();Array.isArray(e)||(e=[e]);var s=0;return e.forEach((function(e){for(var n=0;n<i.__datas.length;n++){var r=i.__datas[n],a="object"==typeof e?e[i.__opt.uniqueKey]:e;if((i.__opt.uniqueType===t.increment&&/\d+/.test(a)?parseInt(a):a)===r[i.__opt.uniqueKey]){i.__datas.splice(n,1),s++;break}}})),s>0?this.__opt.success(0,n):this.__opt.failure(0,r)},a.prototype.asyncDelete=function(t,e,n,r){var i=this;return this.__async((function(){return i.delete(t,e,n)}),r)},a.prototype.exist=function(t,n,r,s){var a=this;return t?this.__filter(t,(function(t){if(1===t.length){var e={};return"object"==typeof s&&(e=i(e,t[0]),e=i(e,s)),a.__opt.success("object"==typeof s?e:t[0],n)}return a.__opt.failure(0,r)}),e.every):this.__noparam()},a.prototype.asyncExist=function(t,e,n,r,i){var s=this;return this.__async((function(){return s.exist(t,e,n,r)}),i)},a.prototype.list=function(t,n){var r=this;return t&&Object.keys(t).length?this.__filter(t,(function(t){return t.length?r.__opt.success(t,n):r.__opt.success(r.__datas,n)}),e.some):this.__opt.success(this.__datas,n)},a.prototype.asyncList=function(t,e,n){var r=this;return this.__async((function(){return r.list(t,e)}),n)},a.prototype.pageList=function(t,n,r){var i=this,s=t.pageSize,a=t.pageIndex;if(!s||!a)return this.__noparam();"string"==typeof s&&(s=parseInt(s)),"string"==typeof a&&(a=parseInt(a));var o=this.__datas;n&&this.__filter(n,(function(t){return t.length?o=t:i.__datas.length?o=i.__datas:t}),e.some);var u=o.length,c=Math.ceil(u/s),_=a>c?c:a<1?1:a,h=u-(c-1)*s+(c-1)*s,p=this.__datas.slice((a-1)*s,a<c?a*s:h);return this.__opt.success({total:u,pageIndex:_,pageSize:s,pageCount:c,list:p},r)},a.prototype.asyncPageList=function(t,e,n,r){var i=this;return this.__async((function(){return i.pageList(t,e,n)}),r)},a}(),o=Symbol?Symbol():"▒";function u(t){var e=Array.isArray(t)?[]:{};for(var n in t)if(r(t,n)){var i=t[n];e[n]="object"==typeof i?u(i):i}return e}return function(){function t(){this.__funcs=[],this.__data=[],this.__propKey="setting",this.__access=new a,this.use=this.use.bind(this),this.gen=this.gen.bind(this)}return t.prototype.setv=function(t,e){var n=t.length-1;t.reduce((function(t,r,i){return i===n&&(t[r]=e),t[r]}),this.__data)},t.prototype.addChild=function(t,e,n){var r=n.key||"children",i=this.getList(t,n);if(e<1)return i;var s=u(i);e--;for(var a=0,o=s.length;a<o;a++)s[a][r]=1===e?u(i):this.addChild(i[a],e,n);return s},t.prototype.getList=function(t,e){if(e){var n=function(t){var e=1;return"number"==typeof t?e=t:Array.isArray(t)&&"number"==typeof t[0]&&"number"==typeof t[1]&&(e=~~(Math.random()*(t[1]-t[0])+t[0])),e},r="number"==typeof e||Array.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]?n(e):"object"==typeof e&&e.length?n(e.length):1,i=new Array(r);delete t[this.__propKey];for(var s=0;s<r;s++)i[s]=u(t);t=i}return t},t.prototype.parseBlock=function(){var t=this,e=function(n,i){!Array.isArray(n)&&r(n,t.__propKey)&&(n=function(e){var n=e[t.__propKey];if(Array.isArray(n)||"object"!=typeof n)e=t.getList(e,n);else{var r="number"==typeof n.level?n.level:1;e=t.addChild(e,r,n)}return e}(n),i?t.setv(i,n):t.setv([],t.__data=n));var s=function(t){if(r(n,t)){var s=n[t];Array.isArray(s)&&s[0]!==o?s.forEach((function(n,r){return e(n,i?i.concat([t,r]):[t,r])})):Array.isArray(s)||"object"!=typeof s||e(s,i?i.concat([t]):[t])}};for(var a in n)s(a)};e(this.__data)},t.prototype.setValues=function(t,e){var n=this;if(Array.isArray(t))if(t[0]===o){var r=e||[],i=this.__funcs[t[1]].concat();try{this.setv(r,i.length>0?i[0].apply(i,i[1]):t)}catch(e){throw new Error((r.length>0?r.join("."):t)+": error, "+e)}}else t.forEach((function(t,r){return n.setValues(t,e?e.concat([r]):[r])}));else"object"==typeof t&&Object.keys(t).forEach((function(r){return n.setValues(t[r],e?e.concat([r]):[r])}))},t.prototype.use=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return[o,this.__funcs.push([t,e])-1]},t.prototype.gen=function(t,e){if("object"==typeof t)return e&&(this.__propKey=e),this.__data=t,this.parseBlock(),this.setValues(this.__data),this.__access.data=this.__data,this.__data},Object.defineProperty(t.prototype,"access",{get:function(){return this.__access},enumerable:!0,configurable:!0}),t}()}));
//# sourceMappingURL=shai.js.map
